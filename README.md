# DataBase_project-Library
 
## Структура базы данных.

База данных состоит из основных таблиц:
* `Book`. Содержит в себе вторичный ключ на таблицу хранилище.
* `Genre`.
* `Author`.
* `Storage`. Он показывает, где хранится книга (книгохранилище, читальный зал и т.д.). 
* `Reader`. 
* `Order` (выдача книги). Содержит в себе вторичный ключ на таблицы `Book`, `Reader`.

И соединительных таблиц:
* `Book_author`. Состоит из вторичных ключей на таблицы `Book`, `Author`.
* `Book_genre`. Состоит из вторичных ключей на таблицы `Book`, `Genre`.
Они используются потому что возможна ситуация, когда у одной книги может быть несколько жанров или авторов.
Более подробную структуру вы можете посмотреть на картинке `scheme.png`.

Представления:
* `Not_returned_books`. Все книги, которые находятся в выдаче.
* `Exprited_books` - книги с истекшим сроком сдачи. Дополнительно приводятся данные о читателе, чтобы можно было с ним связаться и узнать, когда он вернет книгу.

## Содержание файлов

Содержание `progect.sql` файла(в скобках указаны строчки):
* Создание таблиц(1-67).
* Создание вторичных ключей(70-84).
* Создание представлений(87-104).
* Удаление таблиц базы данных(110-122).
* Выборка последних 10 строк из основных таблиц(124-131).

Содержание `data.sql` файла - типовые данные для заполнения таблиц.

Содержание `example.sql` файла - примеры типовых операций:
* Жанры(5-13).
* Автор(16-24).
* Читатель(27-35).
* Книга(38-56).*
* Выдача(59-66).**

*При работе с таблицей `Book` не забывайте, что также вам надо добавить строки в таблицы `Book_author` и `Book_genre`.

**В таблице `Order` нельзя удалять записи, если читатель принес книгу достаточно поменять status с 0 на 1. Также в таблице `Order` автоматически записывается время последнего обновления записи в поле `updated_date`.

## Примеры запросов
Более детальные примеры нахлдятся в файле `examples.sql`.

### Поиск
Поиск в таблицах лучше производить по полям `id`, `code`, `name`, `lastname`.
Пример поиска `id` автора по его фамилии:
```
SELECT `id`, `code`, `lastname`, `firstname` FROM `Author` WHERE `lastname`= 'Author_lastname';
```
### Вставка
Вставка во все таблицы ограничивается всегда одним запросом, кроме ситуации когда вы добаляете Книгу. Необходимо не только добавить запись в таблицу `Book`, но и добавить строчки в таблицы `Book_author`, `Book_genre`.
Пример вставки нового читателя:
```
INSERT INTO `Reader` (`firstname`, `lastname`, `phone`, `adress`) VALUES ('Reader_firstname', 'Reader_lastname', 'Reader_phone', 'Reader_adress');
```

### Обновление
Перед обновлением данных обязательно найдите `id` строки с которой вы хотите работать.
Пример продления книги на 14 дней:
```
UPDATE `Order` SET `expiration_date` = (`expiration_date` + INTERVAL 14 DAY) WHERE `id` = 1 LIMIT 1;
```

### Удаление
Перед удалением данных обязательно найдите `id` строки с которой вы хотите работать.
Удалять можно только из таблиц `Reader`, `Book`, `Author`, `Genre`. При возвращении книги вместо удаления записи, меняется `status` с 0 на 1.
Пример удаления жанра:
```
DELETE FROM `Genre` WHERE `id` = 1 limit 1;
```


